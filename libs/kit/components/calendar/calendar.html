<div class="x-calendar-header">
  <button
    x-icon
    [radius]="radius()"
    [disabled]="mode() === 'months'"
    (click)="navigatePrevious()"
  >
    <x-icon src="chevron-left" />
  </button>

  <x-group class="x-calendar-header-group">
    <button x-btn
            variant="outline"
            [radius]="radius()"
            [attr.aria-pressed]="mode() === 'months'"
            (click)="setMode('months')">
      {{ monthName() }}
    </button>

    <button x-btn
            variant="outline"
            [radius]="radius()"
            [attr.aria-pressed]="mode() === 'years'"
            (click)="setMode('years')">
      {{ year() }}
    </button>
  </x-group>

  <button
    x-icon
    [radius]="radius()"
    [disabled]="mode() === 'months'"
    (click)="navigateNext()"
  >
    <x-icon src="chevron-right" />
  </button>
</div>

@let $ = slots() | asRecord;

<div class="x-calendar-content">
  @switch (mode()) {
    @case ('days') {
      <div class="x-calendar-days">
        @for (day of dayNames(); track day) {
          <div class="x-calendar-weekday">{{ day }}</div>
        }
      </div>

      <div class="x-calendar-days">
        @for (day of days(); track day.getTime()) {
          @let current = day | map: isCurrentDay;
          @let selected = day | map: daySelected: value();
          @let adjacent = day | map: dayAdjacent: month();
          @let disabled = day | map: dayDisabled: min() : max();

          <button
            type="button"
            class="x-calendar-item"
            [class.x-current]="current"
            [class.x-selected]="selected"
            [class.x-adjacent]="adjacent"
            [class.x-disabled]="disabled"
            (click)="setDay(day)">

            @if ($.day) {
              <ng-container [ngTemplateOutlet]="$.day"
                            [ngTemplateOutletContext]="{ $implicit: { day, current, selected, adjacent, disabled } }">
              </ng-container>
            } @else {
              {{ day }}
            }
          </button>
        }
      </div>
    }
    @case ('months') {
      <div class="x-calendar-months">
        @for (month of months(); track month.getTime()) {
          @let current = month | map: isCurrentMonth;
          @let selected = month | map: monthSelected: value();
          @let disabled = month | map: monthDisabled: min() : max();

          <button
            type="button"
            class="x-calendar-item x-month"
            [class.x-current]="current"
            [class.x-selected]="selected"
            [class.x-disabled]="disabled"
            (click)="setMonth(month)"
          >
            {{ month }}
          </button>
        }
      </div>
    }
    @case ('years') {
      <x-years [year]="month()"
               [value]="value()"
               [min]="min()"
               [max]="max()"
               (yearChange)="setYear($event)">
      </x-years>
    }
  }
</div>
